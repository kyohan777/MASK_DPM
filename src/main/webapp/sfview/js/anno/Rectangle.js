import Anno from"/sfview/js/anno/Anno.js";import Shape from"/sfview/js/anno/Shape.js";export default class Rectangle extends Shape{x=0;y=0;width=0;height=0;angle=0;fillStyle=null;lineWidth=1;constructor(x=0,y=0,width=1,height=1,fillStyle="rgba(91,155,213,0.8)",strokeStyle="#41719C",drawShape=function(ctx){ctx.rect(this.x,this.y,this.width,this.height)}){super(strokeStyle,drawShape);this.x=x;this.y=y;this.width=width;this.height=height;this.fillStyle=fillStyle}move(x,y){this.x=x;this.y=y}moveStep(sx,sy){this.x+=sx;this.y+=sy}sizeStep(sw,sh){this.width+=sw;this.height+=sh}shapeStep(sx,sy,sw,sh){this.moveStep(sx,sy);this.sizeStep(sw,sh)}rotate(ctx,cx=this.midX,cy=this.midY){if(this.angle==0)return;ctx.translate(cx,cy);ctx.rotate(this.angle);ctx.translate(-cx,-cy)}setAngle(degree){this.angle=degree/180*Math.PI}static rotatePoint(x,y,cx,cy,angle){let cos=Math.cos(angle);let sin=Math.sin(angle);let nx=cos*(x-cx)+sin*(y-cy)+cx;let ny=cos*(y-cy)-sin*(x-cx)+cy;return[nx,ny]}rotatePoint(x,y){return Rectangle.rotatePoint(x,y,this.midX,this.midY,this.angle)}rotatePointReverse(x,y){return Rectangle.rotatePoint(x,y,this.midX,this.midY,-this.angle)}get midX(){return this.x+this.width/2}get midY(){return this.y+this.height/2}get endX(){return this.x+this.width}get endY(){return this.y+this.height}contains(rx,ry){return rx>=this.x&&rx<=this.endX&&ry>=this.y&&ry<=this.endY}getStepAngle(x,y){const angle=Math.atan2(y-this.midY,x-this.midX)+Math.PI/2;return angle-this.angle}setStepAngle(angle){this.angle+=angle+Math.PI*2;this.angle%=Math.PI*2}normalize(){if(this.width<0){this.x+=this.width;this.width*=-1}if(this.height<0){this.y+=this.height;this.height*=-1}}*getPoints(){for(let[x,y]of[[this.x,this.y],[this.endX,this.y],[this.x,this.endY],[this.endX,this.endY]]){yield this.rotatePointReverse(x,y)}}setJson(json){super.setJson(json);this.x=json.x,this.y=json.y,this.width=json.width,this.height=json.height;if(json.style)this.fillStyle=json.style.color}getJson(){const json=super.getJson();json.x=this.x;json.y=this.y;json.width=this.width;json.height=this.height;if(this.fillStyle){json.style.color=this.fillStyle}return json}}